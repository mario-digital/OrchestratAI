FROM oven/bun:1-alpine

WORKDIR /app

# Copy package files (note: build context must be set to project root)
# For Bun workspace, we need root package.json + workspace package.json + packages/
COPY package.json bun.lock ./
COPY orchestratai_client/package.json ./orchestratai_client/
# Copy project configuration files required for Next.js resolution
COPY orchestratai_client/tsconfig.json ./orchestratai_client/tsconfig.json
COPY orchestratai_client/next.config.ts ./orchestratai_client/next.config.ts
COPY orchestratai_client/postcss.config.mjs ./orchestratai_client/postcss.config.mjs
COPY orchestratai_client/vitest.config.ts ./orchestratai_client/vitest.config.ts
COPY orchestratai_client/eslint.config.mjs ./orchestratai_client/eslint.config.mjs
COPY orchestratai_client/eslint-local-rules.mjs ./orchestratai_client/eslint-local-rules.mjs
COPY packages/ ./packages/

# Install dependencies for the workspace
# Note: Using --no-save to avoid lockfile changes during build
RUN bun install --no-save

# Don't copy code (will be mounted as volume)

EXPOSE 3000

# Use next dev directly
WORKDIR /app/orchestratai_client
CMD ["bun", "next", "dev", "--turbopack"]
