# Story 1.10: Create Mobile Responsive Layout with Tabbed Interface

<!-- Powered by BMAD™ Core -->

## Status

**Draft**

---

## Story

**As a** Frontend Developer,
**I want** to create a mobile-responsive tabbed interface that replaces the desktop three-panel layout on smaller screens,
**so that** users can access all functionality (Chat, Agents, Logs) on mobile devices with an intuitive navigation experience.

---

## Acceptance Criteria

1. Mobile layout component created at `orchestratai_client/src/components/layout/mobile-layout.tsx`
2. Layout displays three tabs: "Chat", "Agents", "Logs"
3. Mobile layout activates on screens <768px (Tailwind `md:` breakpoint)
4. Desktop three-panel layout hidden on mobile (<768px)
5. Only one tab panel visible at a time (full-screen)
6. Active tab visually indicated with styling
7. Tab switching updates URL hash (e.g., `#chat`, `#agents`, `#logs`)
8. Default tab is "Chat" on initial load
9. Tab state persists when switching between tabs
10. Footer component remains visible below tabs on mobile
11. Header component remains visible above tabs on mobile
12. Component uses shadcn/ui Tabs component from Story 1.6
13. Component uses design tokens (no hardcoded colors)
14. TypeScript compilation succeeds with zero errors
15. **Unit tests written**: 4 comprehensive tests using Vitest + React Testing Library
16. All tests pass with `bun test`
17. Component is keyboard accessible (arrow keys navigate tabs)
18. Component has proper ARIA labels

---

## Tasks / Subtasks

- [ ] **Task 1: Create Mobile Layout Component** (AC: 1, 2, 5, 6, 12, 13)
  - [ ] Create file: `orchestratai_client/src/components/layout/mobile-layout.tsx`
  - [ ] Import shadcn/ui `Tabs`, `TabsList`, `TabsTrigger`, `TabsContent` from Story 1.6
  - [ ] Define `MobileLayoutProps` interface with `children` prop
  - [ ] Implement three tabs: Chat, Agents, Logs
  - [ ] Use design tokens for tab styling (bg-background, text-foreground, border-border-default)
  - [ ] Ensure only one tab panel visible at a time (full-screen layout)
  - [ ] Add visual indicator for active tab

- [ ] **Task 2: Implement Tab State Management** (AC: 7, 8, 9)
  - [ ] Use `useState` to manage active tab
  - [ ] Default active tab: "chat"
  - [ ] Update URL hash when tab changes (e.g., `window.location.hash = '#chat'`)
  - [ ] Read initial tab from URL hash on mount
  - [ ] Preserve tab content when switching tabs (components remain mounted)

- [ ] **Task 3: Integrate with Root Layout** (AC: 3, 4, 10, 11)
  - [ ] Update `orchestratai_client/src/app/layout.tsx` or page file
  - [ ] Conditionally render `<MobileLayout>` on `<768px` screens
  - [ ] Conditionally render `<ThreePanelLayout>` on `>=768px` screens
  - [ ] Use Tailwind responsive classes: `md:hidden` for mobile, `hidden md:grid` for desktop
  - [ ] Ensure Header and Footer visible on all screen sizes

- [ ] **Task 4: Write Unit Tests** (AC: 15, 16)
  - [ ] Create test file: `orchestratai_client/tests/unit/components/layout/mobile-layout.test.tsx`
  - [ ] Test 1: Renders three tabs with correct labels
  - [ ] Test 2: Chat tab active by default
  - [ ] Test 3: Clicking tab changes active tab
  - [ ] Test 4: URL hash updates when tab changes
  - [ ] Run `bun test` and verify all tests pass

- [ ] **Task 5: Verify Accessibility** (AC: 17, 18)
  - [ ] Test keyboard navigation (arrow keys to navigate tabs)
  - [ ] Verify ARIA labels on tabs (`role="tablist"`, `role="tab"`, `role="tabpanel"`)
  - [ ] Verify focus indicators visible on tab triggers
  - [ ] Test screen reader compatibility (optional but recommended)

- [ ] **Task 6: Validate TypeScript Compilation** (AC: 14)
  - [ ] Run `bunx tsc --noEmit --project orchestratai_client/tsconfig.json`
  - [ ] Verify zero TypeScript errors
  - [ ] Fix any type errors if found

- [ ] **Task 7: Manual Testing** (AC: 3, 4, 5, 10, 11)
  - [ ] Start dev server: `bun dev`
  - [ ] Open http://localhost:3000 in browser
  - [ ] Resize browser window to <768px
  - [ ] Verify mobile tabbed layout displays (desktop grid hidden)
  - [ ] Click each tab and verify correct panel displays
  - [ ] Verify Header and Footer remain visible
  - [ ] Resize browser window to >=768px
  - [ ] Verify desktop three-panel layout displays (mobile tabs hidden)

---

## Dev Notes

### Previous Story Dependencies

[Source: docs/stories/1.7.create-desktop-three-panel-layout.story.md]

**Desktop Layout Component:**
- **Component**: `orchestratai_client/src/components/layout/three-panel-layout.tsx`
- **Grid Layout**: `250px | 1fr | 300px` (Agent Pipeline | Chat | Retrieval Log)
- **Responsive**: Hidden on mobile (`hidden md:grid`)
- **Integration Point**: This story creates the mobile alternative

[Source: docs/stories/1.9.create-header-footer-components.story.md]

**Header and Footer Components:**
- **Header**: `orchestratai_client/src/components/layout/header.tsx`
- **Footer**: `orchestratai_client/src/components/layout/footer.tsx`
- **Usage**: Both remain visible on mobile and desktop
- **Placement**: Header above layout, Footer below layout

[Source: docs/stories/1.6.install-shadcn-ui-components.story.md]

**shadcn/ui Tabs Component:**
- **Component**: `orchestratai_client/src/components/ui/tabs.tsx` (NOT YET INSTALLED)
- **Action Required**: Install Tabs component before starting this story
- **Command**: `bunx shadcn@latest add tabs`
- **Exports**: `Tabs`, `TabsList`, `TabsTrigger`, `TabsContent`

### Mobile Layout Specifications

[Source: docs/prd/orchestratai_prd_v2.md - Section 4.2]

**Mobile Layout Requirements (<768px):**

```
┌─────────────────────────────────────┐
│ Header (OrchestratAI)               │
├─────────────────────────────────────┤
│ [Chat] [Agents] [Logs]  ← Tabs      │
├─────────────────────────────────────┤
│                                     │
│  Active Tab Panel (Full Screen)    │
│                                     │
│  • Chat: Chat interface             │
│  • Agents: Agent pipeline panel     │
│  • Logs: Retrieval logs panel       │
│                                     │
├─────────────────────────────────────┤
│ Footer (Metrics)                    │
└─────────────────────────────────────┘
```

**Tabbed Interface Behavior:**
- **Three Tabs**: Chat | Agents | Logs
- **Default Tab**: Chat (active on initial load)
- **Full-Screen Panels**: Each tab displays its panel at full width/height
- **Tab Persistence**: Tab content remains mounted when switching tabs (performance optimization)
- **URL Hash**: Tab state reflected in URL hash for deep linking
- **Footer Stats**: Same responsive footer from Story 1.9

### Complete Implementation Code

**File**: `orchestratai_client/src/components/layout/mobile-layout.tsx`

```typescript
'use client';

import { useEffect, useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';

export interface MobileLayoutProps {
  chatPanel: React.ReactNode;
  agentsPanel: React.ReactNode;
  logsPanel: React.ReactNode;
}

export function MobileLayout({ chatPanel, agentsPanel, logsPanel }: MobileLayoutProps) {
  const [activeTab, setActiveTab] = useState('chat');

  // Read initial tab from URL hash on mount
  useEffect(() => {
    const hash = window.location.hash.replace('#', '');
    if (hash === 'agents' || hash === 'logs' || hash === 'chat') {
      setActiveTab(hash);
    }
  }, []);

  // Update URL hash when tab changes
  const handleTabChange = (value: string) => {
    setActiveTab(value);
    window.location.hash = `#${value}`;
  };

  return (
    <div className="md:hidden min-h-screen flex flex-col">
      <Tabs value={activeTab} onValueChange={handleTabChange} className="flex-1 flex flex-col">
        <TabsList className="w-full justify-start border-b border-border-default bg-bg-secondary rounded-none">
          <TabsTrigger value="chat" className="flex-1">
            Chat
          </TabsTrigger>
          <TabsTrigger value="agents" className="flex-1">
            Agents
          </TabsTrigger>
          <TabsTrigger value="logs" className="flex-1">
            Logs
          </TabsTrigger>
        </TabsList>

        <TabsContent value="chat" className="flex-1 m-0 p-4" aria-label="Chat Interface">
          {chatPanel}
        </TabsContent>

        <TabsContent value="agents" className="flex-1 m-0 p-4" aria-label="Agent Pipeline">
          {agentsPanel}
        </TabsContent>

        <TabsContent value="logs" className="flex-1 m-0 p-4" aria-label="Retrieval Log">
          {logsPanel}
        </TabsContent>
      </Tabs>
    </div>
  );
}
```

**Usage Example** (Integration in Root Layout or Page):

```typescript
// orchestratai_client/src/app/page.tsx
import { ThreePanelLayout } from '@/components/layout/three-panel-layout';
import { MobileLayout } from '@/components/layout/mobile-layout';
import { Header } from '@/components/layout/header';
import { Footer } from '@/components/layout/footer';

export default function HomePage() {
  // Placeholder panels (to be replaced with real components in Epic 2+)
  const chatPanel = <div>Chat Interface Placeholder</div>;
  const agentsPanel = <div>Agent Pipeline Placeholder</div>;
  const logsPanel = <div>Retrieval Logs Placeholder</div>;

  return (
    <>
      <Header />

      {/* Desktop Layout (>=768px) */}
      <ThreePanelLayout leftPanel={agentsPanel} rightPanel={logsPanel}>
        {chatPanel}
      </ThreePanelLayout>

      {/* Mobile Layout (<768px) */}
      <MobileLayout chatPanel={chatPanel} agentsPanel={agentsPanel} logsPanel={logsPanel} />

      <Footer />
    </>
  );
}
```

### Complete Unit Tests

**File**: `orchestratai_client/tests/unit/components/layout/mobile-layout.test.tsx`

```typescript
import { describe, it, expect, beforeEach, afterEach } from 'vitest';
import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { MobileLayout } from '@/components/layout/mobile-layout';

describe('MobileLayout', () => {
  const mockChatPanel = <div>Chat Panel Content</div>;
  const mockAgentsPanel = <div>Agents Panel Content</div>;
  const mockLogsPanel = <div>Logs Panel Content</div>;

  let originalHash: string;

  beforeEach(() => {
    // Save original hash
    originalHash = window.location.hash;
    // Reset hash before each test
    window.location.hash = '';
  });

  afterEach(() => {
    // Restore original hash
    window.location.hash = originalHash;
  });

  it('renders three tabs with correct labels', () => {
    render(
      <MobileLayout
        chatPanel={mockChatPanel}
        agentsPanel={mockAgentsPanel}
        logsPanel={mockLogsPanel}
      />
    );

    expect(screen.getByRole('tab', { name: /chat/i })).toBeInTheDocument();
    expect(screen.getByRole('tab', { name: /agents/i })).toBeInTheDocument();
    expect(screen.getByRole('tab', { name: /logs/i })).toBeInTheDocument();
  });

  it('displays chat tab by default', () => {
    render(
      <MobileLayout
        chatPanel={mockChatPanel}
        agentsPanel={mockAgentsPanel}
        logsPanel={mockLogsPanel}
      />
    );

    expect(screen.getByText('Chat Panel Content')).toBeVisible();
    expect(screen.queryByText('Agents Panel Content')).not.toBeVisible();
    expect(screen.queryByText('Logs Panel Content')).not.toBeVisible();
  });

  it('switches to agents tab when clicked', async () => {
    const user = userEvent.setup();

    render(
      <MobileLayout
        chatPanel={mockChatPanel}
        agentsPanel={mockAgentsPanel}
        logsPanel={mockLogsPanel}
      />
    );

    const agentsTab = screen.getByRole('tab', { name: /agents/i });
    await user.click(agentsTab);

    expect(screen.getByText('Agents Panel Content')).toBeVisible();
    expect(screen.queryByText('Chat Panel Content')).not.toBeVisible();
    expect(screen.queryByText('Logs Panel Content')).not.toBeVisible();
  });

  it('updates URL hash when tab changes', async () => {
    const user = userEvent.setup();

    render(
      <MobileLayout
        chatPanel={mockChatPanel}
        agentsPanel={mockAgentsPanel}
        logsPanel={mockLogsPanel}
      />
    );

    const logsTab = screen.getByRole('tab', { name: /logs/i });
    await user.click(logsTab);

    expect(window.location.hash).toBe('#logs');
  });
});
```

**Test Commands:**

```bash
# Run all tests
bun test

# Run mobile-layout tests only
bun test mobile-layout

# Run tests in watch mode
bun test --watch

# Run tests with coverage
bun test --coverage
```

### Responsive Breakpoints

[Source: docs/architecture/16-coding-standards.md - Section 6]

**Tailwind CSS Responsive Breakpoints:**

```css
/* Mobile First Approach */
/* Default styles = Mobile (<768px) */

md:   /* >=768px  - Tablet and Desktop */
lg:   /* >=1024px - Desktop */
xl:   /* >=1280px - Large Desktop */
```

**Usage Pattern:**

```tsx
{/* Show on mobile only */}
<div className="block md:hidden">Mobile Content</div>

{/* Hide on mobile, show on desktop */}
<div className="hidden md:block">Desktop Content</div>
```

### Design Token Integration

[Source: docs/architecture/16-coding-standards.md - Section 5]

**Mobile Layout Uses Semantic Tokens:**

```tsx
// TabsList styling
className="border-b border-border-default bg-bg-secondary"

// These resolve to:
// border-border-default → var(--color-border-default) → var(--token-color-slate-300)
// bg-bg-secondary → var(--color-bg-secondary) → var(--token-color-slate-100)
```

**No Hardcoded Colors Allowed:**

```tsx
// ❌ WRONG: Hardcoded colors
<div className="bg-gray-100 text-gray-900">

// ✅ CORRECT: Semantic tokens
<div className="bg-bg-secondary text-text-primary">
```

### Accessibility Standards

[Source: docs/architecture/15-testing-strategy.md]

**shadcn/ui Tabs Component (Radix UI):**
- ✅ Automatic ARIA roles: `role="tablist"`, `role="tab"`, `role="tabpanel"`
- ✅ Keyboard navigation: Arrow keys navigate tabs
- ✅ Focus management: Focus indicator on active tab
- ✅ Screen reader support: Announces tab changes

**Manual Accessibility Testing:**
1. **Keyboard Navigation**:
   - Press `Tab` to focus tab list
   - Press `→` (right arrow) to move to next tab
   - Press `←` (left arrow) to move to previous tab
   - Press `Home` to jump to first tab
   - Press `End` to jump to last tab

2. **Screen Reader** (optional):
   - macOS: VoiceOver (`Cmd + F5`)
   - Windows: NVDA (free screen reader)

### Testing Standards

[Source: docs/architecture/15-testing-strategy.md]

**Unit Testing Requirements:**
- **Framework**: Vitest + React Testing Library
- **Test Location**: `orchestratai_client/tests/unit/components/layout/`
- **Coverage**: 4 tests covering core functionality
- **No Mocking**: Test real component behavior (no mock tabs)

**Test Coverage Areas:**
1. **Rendering**: Three tabs render with correct labels
2. **Default State**: Chat tab active by default
3. **User Interaction**: Tab switching works
4. **URL State**: Hash updates when tab changes

### File Structure After Story Completion

[Source: docs/architecture/source-tree.md]

```
orchestratai_client/src/
├── components/
│   ├── ui/
│   │   ├── tabs.tsx                 # shadcn/ui Tabs (install first!)
│   │   └── [other-shadcn-components]
│   │
│   └── layout/
│       ├── three-panel-layout.tsx   # Story 1.7 (Desktop layout)
│       ├── mobile-layout.tsx        # THIS STORY (Mobile tabs)
│       ├── header.tsx               # Story 1.9
│       └── footer.tsx               # Story 1.9
│
├── app/
│   ├── layout.tsx                   # Root layout (updated to use both layouts)
│   └── page.tsx                     # Home page (integration point)
│
└── tests/unit/components/layout/
    ├── three-panel-layout.test.tsx  # Story 1.7 tests
    ├── mobile-layout.test.tsx       # THIS STORY (4 tests)
    ├── header.test.tsx              # Story 1.9 tests
    └── footer.test.tsx              # Story 1.9 tests
```

### Coding Standards Compliance

[Source: docs/architecture/16-coding-standards.md]

**Critical Rules:**
- ✅ **Design Tokens**: Use `bg-bg-secondary`, `border-border-default` (NO `bg-gray-100`)
- ✅ **'use client' Directive**: Component uses `useState` and `useEffect` (client component)
- ✅ **Import Alias**: Use `@/components/ui/tabs` (NOT relative paths)
- ✅ **TypeScript**: Strict mode enabled, all props typed
- ✅ **Naming Convention**: `mobile-layout.tsx` (kebab-case for files)
- ✅ **Component Naming**: `MobileLayout` (PascalCase for components)

### Optional Enhancements (Post-MVP)

[Source: docs/prd/orchestratai_prd_v2.md - Future Enhancements]

**Swipeable Tabs** (Phase 3+):
- Use `react-swipeable` library
- Swipe left/right to navigate tabs
- Haptic feedback on mobile devices

```bash
# Future enhancement
bun add react-swipeable
```

**Tab Transition Animations** (Phase 3+):
- Use Framer Motion for smooth tab transitions
- Slide in/out animations when switching tabs

```bash
# Future enhancement
bun add framer-motion
```

**These are NOT required for MVP** - Story 1.10 focuses on basic tabbed interface functionality.

### Troubleshooting

**Issue: Tabs component not found**
- **Solution**: Install shadcn/ui Tabs component first
- **Command**: `bunx shadcn@latest add tabs`
- **Verify**: Check `src/components/ui/tabs.tsx` exists

**Issue: Desktop layout still showing on mobile**
- **Solution**: Verify `ThreePanelLayout` has `hidden md:grid` class
- **Check**: Inspect browser viewport width (must be <768px)

**Issue: URL hash not updating**
- **Solution**: Ensure component is client-side (`'use client'` directive)
- **Check**: `useState` and `useEffect` only work in client components

**Issue: TypeScript error on Tabs component**
- **Solution**: Run `bun install` to install Radix UI peer dependencies
- **Check**: Verify `@radix-ui/react-tabs` in `package.json` dependencies

**Issue: Tests failing on window.location.hash**
- **Solution**: Tests include `beforeEach` and `afterEach` to reset hash
- **Check**: Ensure `jsdom` environment configured in `vitest.config.ts`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-24 | 1.0 | Initial story creation for mobile responsive layout | Bob (Scrum Master) |

---

## Dev Agent Record

### Agent Model Used

*To be completed by Dev Agent*

### Debug Log References

*To be completed by Dev Agent*

### Completion Notes

*To be completed by Dev Agent*

### File List

*To be completed by Dev Agent*

---

## QA Results

*To be completed by QA Agent*
