# Story 1.7: Create Desktop Three-Panel Layout

<!-- Powered by BMAD™ Core -->

## Status

**Draft**

---

## Story

**As a** Frontend Developer,
**I want** to create a responsive three-panel desktop layout with left (agent pipeline), center (chat), and right (retrieval log) panels,
**so that** users can view agent status, chat conversation, and retrieval logs simultaneously on desktop screens (1024px+).

---

## Acceptance Criteria

1. Layout component created at `orchestratai_client/src/components/layout/three-panel-layout.tsx`
2. Layout uses CSS Grid with three columns: 250px (left) | 1fr (center) | 300px (right)
3. Layout renders on screens 1024px and wider
4. Left panel placeholder created for agent pipeline (Epic 3 will implement content)
5. Center panel placeholder created for chat interface (Epic 2 will implement content)
6. Right panel placeholder created for retrieval logs (Epic 3 will implement content)
7. Each panel has distinctive background color using design tokens
8. Panels use Separator component between them for visual division
9. Layout has proper semantic HTML (main, aside, section tags)
10. Layout is keyboard accessible (can Tab through panels)
11. Layout uses Server Component by default (no 'use client' directive needed)
12. TypeScript compilation succeeds with zero errors
13. Unit tests written using Vitest + React Testing Library
14. Test: Layout renders three panels correctly
15. Test: Layout uses correct grid column widths (250px, 1fr, 300px)
16. Test: Panels are properly labeled for accessibility
17. All unit tests pass

---

## Tasks / Subtasks

- [ ] **Task 1: Create Layout Component File** (AC: 1, 11)
  - [ ] Create directory `orchestratai_client/src/components/layout/` if not exists
  - [ ] Create file `orchestratai_client/src/components/layout/three-panel-layout.tsx`
  - [ ] Do NOT add 'use client' directive (Server Component by default)
  - [ ] Import React types (ReactNode for children prop)

- [ ] **Task 2: Implement Grid Layout Structure** (AC: 2, 3, 9)
  - [ ] Create functional component `ThreePanelLayout`
  - [ ] Accept `children` prop (for future chat content)
  - [ ] Use semantic HTML: `<main>` for center, `<aside>` for left/right panels
  - [ ] Apply Tailwind grid classes: `grid grid-cols-[250px_1fr_300px]`
  - [ ] Add responsive class: `hidden md:grid` (shows only on 1024px+)
  - [ ] Set minimum height: `min-h-screen`

- [ ] **Task 3: Create Left Panel (Agent Pipeline Placeholder)** (AC: 4, 7)
  - [ ] Create `<aside>` element with `aria-label="Agent Pipeline"`
  - [ ] Apply design token background: `bg-bg-secondary` (from @theme)
  - [ ] Add padding: `p-4`
  - [ ] Add placeholder text: "Agent Pipeline (Epic 3)"
  - [ ] Add border-right using design tokens: `border-r border-border-default`

- [ ] **Task 4: Create Center Panel (Chat Placeholder)** (AC: 5, 7)
  - [ ] Create `<main>` element with `aria-label="Chat Interface"`
  - [ ] Apply design token background: `bg-bg-primary`
  - [ ] Add padding: `p-4`
  - [ ] Render `{children}` prop for future chat content
  - [ ] Add placeholder text: "Chat Interface (Epic 2)"

- [ ] **Task 5: Create Right Panel (Retrieval Log Placeholder)** (AC: 6, 7)
  - [ ] Create `<aside>` element with `aria-label="Retrieval Log"`
  - [ ] Apply design token background: `bg-bg-secondary`
  - [ ] Add padding: `p-4`
  - [ ] Add placeholder text: "Retrieval Log (Epic 3)"
  - [ ] Add border-left using design tokens: `border-l border-border-default`

- [ ] **Task 6: Add Panel Separators** (AC: 8)
  - [ ] Import Separator component from `@/components/ui/separator`
  - [ ] Add Separator between left and center panels (vertical orientation)
  - [ ] Add Separator between center and right panels (vertical orientation)
  - [ ] Verify separators use design tokens for border colors

- [ ] **Task 7: Ensure Accessibility** (AC: 10, 16)
  - [ ] Add `aria-label` to each panel describing its purpose
  - [ ] Verify semantic HTML structure (main, aside, section)
  - [ ] Test keyboard navigation (Tab key moves through panels)
  - [ ] Add `tabIndex={0}` to panels if needed for focus

- [ ] **Task 8: Validate TypeScript Compilation** (AC: 12)
  - [ ] Run `bunx tsc --noEmit --project orchestratai_client/tsconfig.json`
  - [ ] Verify zero TypeScript errors
  - [ ] Fix any type errors

- [ ] **Task 9: Create Unit Test File** (AC: 13)
  - [ ] Create directory `orchestratai_client/tests/unit/components/layout/` if not exists
  - [ ] Create file `three-panel-layout.test.tsx`
  - [ ] Import Vitest utilities: `describe`, `it`, `expect`
  - [ ] Import React Testing Library: `render`, `screen`
  - [ ] Import component: `ThreePanelLayout`

- [ ] **Task 10: Write Unit Test - Layout Renders** (AC: 14, 17)
  - [ ] Write test: "renders three panels"
  - [ ] Render `<ThreePanelLayout>Test Content</ThreePanelLayout>`
  - [ ] Assert left panel exists: `screen.getByLabelText('Agent Pipeline')`
  - [ ] Assert center panel exists: `screen.getByLabelText('Chat Interface')`
  - [ ] Assert right panel exists: `screen.getByLabelText('Retrieval Log')`
  - [ ] Assert children render: `screen.getByText('Test Content')`

- [ ] **Task 11: Write Unit Test - Grid Column Widths** (AC: 15, 17)
  - [ ] Write test: "uses correct grid column widths"
  - [ ] Render `<ThreePanelLayout />`
  - [ ] Query grid container element
  - [ ] Assert grid template columns: `grid-cols-[250px_1fr_300px]`
  - [ ] Verify class is applied using `toHaveClass()`

- [ ] **Task 12: Write Unit Test - Accessibility** (AC: 16, 17)
  - [ ] Write test: "panels are properly labeled for accessibility"
  - [ ] Render `<ThreePanelLayout />`
  - [ ] Assert `aria-label` on left panel
  - [ ] Assert `aria-label` on center panel
  - [ ] Assert `aria-label` on right panel
  - [ ] Verify semantic HTML: main, aside tags

- [ ] **Task 13: Run Unit Tests** (AC: 17)
  - [ ] Run `bun test` (runs Vitest)
  - [ ] Verify all 3 tests pass
  - [ ] Fix any failing tests
  - [ ] Check test coverage (should be 100% for this component)

- [ ] **Task 14: Manual Browser Testing**
  - [ ] Import layout in `app/page.tsx` temporarily
  - [ ] Start dev server: `bun dev` or `docker compose up`
  - [ ] Navigate to http://localhost:3000
  - [ ] Verify layout renders correctly on desktop (1024px+)
  - [ ] Verify layout hidden on mobile (<1024px)
  - [ ] Verify panels use design token colors
  - [ ] Remove temporary import from `app/page.tsx`

---

## Dev Notes

### Previous Story Insights

[Source: docs/stories/1.2.create-token-file-structure.story.md, 1.6.install-shadcn-ui-components.story.md]

**Design Token Foundation:**
- **Semantic Tokens Available**: Story 1.2 created `@theme` block with bg-primary, bg-secondary, border-default, etc.
- **shadcn/ui Components**: Story 1.6 installed Separator component for panel dividers

**Key Dependencies:**
- Design tokens from Story 1.2 for backgrounds and borders
- Separator component from Story 1.6 for visual division
- Responsive utilities from Tailwind CSS v4

### Tech Stack Context

[Source: docs/architecture/3-tech-stack.md, docs/architecture/9-frontend-architecture.md]

**Layout Stack:**
- **Next.js 15**: Server Components First (no 'use client' needed for static layouts)
- **Tailwind CSS v4**: CSS Grid utilities, responsive breakpoints
- **React 19**: Latest features (not needed for this simple layout)
- **TypeScript 5.6+**: Strict mode enabled

**Testing Stack:**
- **Vitest**: Fast unit test runner (Vite-based, already configured)
- **React Testing Library**: Component testing utilities
- **@testing-library/jest-dom**: Custom matchers (toBeInTheDocument, toHaveClass, etc.)

### Layout Specifications

[Source: docs/prd/orchestratai_prd_v2.md - Section 4.1, docs/stories/epic-1-foundation-design-system.md]

**Desktop Layout (1024px+):**
- **3-Column CSS Grid**: `grid-cols-[250px_1fr_300px]`
- **Left Panel**: 250px fixed width (Agent Pipeline)
- **Center Panel**: 1fr flexible width (Chat Interface)
- **Right Panel**: 300px fixed width (Retrieval Log)
- **Minimum Height**: `min-h-screen` (full viewport height)

**Responsive Behavior:**
- **Desktop (1024px+)**: Show three-panel grid layout
- **Tablet/Mobile (<1024px)**: Hide grid, show tabbed interface (Story 1.10)

**Panel Content (Placeholders for This Story):**
- **Left**: "Agent Pipeline (Epic 3)" - Will show 4 agent cards with status
- **Center**: Render {children} prop - Will be ChatInterface in Epic 2
- **Right**: "Retrieval Log (Epic 3)" - Will show operation logs

### Semantic HTML Structure

[Source: docs/architecture/16-coding-standards.md]

**Correct Semantic Tags:**

```tsx
// ✅ CORRECT: Proper semantic HTML
<div className="grid grid-cols-[250px_1fr_300px] min-h-screen">
  {/* Left Panel: Aside for supplementary content */}
  <aside aria-label="Agent Pipeline" className="bg-bg-secondary p-4">
    {/* Agent cards will go here */}
  </aside>

  {/* Center Panel: Main for primary content */}
  <main aria-label="Chat Interface" className="bg-bg-primary p-4">
    {children}
  </main>

  {/* Right Panel: Aside for supplementary content */}
  <aside aria-label="Retrieval Log" className="bg-bg-secondary p-4">
    {/* Logs will go here */}
  </aside>
</div>

// ❌ WRONG: All divs, no semantic meaning
<div className="grid">
  <div>{/* Left */}</div>
  <div>{/* Center */}</div>
  <div>{/* Right */}</div>
</div>
```

### Design Token Usage

[Source: docs/architecture/16-coding-standards.md - Section 5]

**Background Colors (from @theme):**
- `bg-bg-primary`: Primary background (slate-950) - Center panel
- `bg-bg-secondary`: Secondary background (slate-900) - Side panels
- `bg-bg-tertiary`: Tertiary background (slate-800) - Future use

**Border Colors (from @theme):**
- `border-border-default`: Default border color (gray-700)
- `border-border-subtle`: Subtle border color (gray-800)

**Correct Pattern:**
```tsx
// ✅ CORRECT: Use semantic tokens from @theme
<aside className="bg-bg-secondary border-r border-border-default">

// ❌ WRONG: Direct Tailwind color classes
<aside className="bg-slate-900 border-gray-700">
```

### Component Structure

[Source: docs/architecture/9-frontend-architecture.md - Section 9.1]

**File Location:**
```
orchestratai_client/src/components/layout/three-panel-layout.tsx
```

**Component Pattern (Server Component):**

```tsx
import { ReactNode } from 'react';
import { Separator } from '@/components/ui/separator';

interface ThreePanelLayoutProps {
  children?: ReactNode; // Future: ChatInterface content
}

export function ThreePanelLayout({ children }: ThreePanelLayoutProps) {
  return (
    <div className="hidden md:grid grid-cols-[250px_1fr_300px] min-h-screen">
      {/* Left Panel */}
      <aside
        aria-label="Agent Pipeline"
        className="bg-bg-secondary p-4 border-r border-border-default"
      >
        <p className="text-text-secondary">Agent Pipeline (Epic 3)</p>
      </aside>

      <Separator orientation="vertical" className="h-full" />

      {/* Center Panel */}
      <main aria-label="Chat Interface" className="bg-bg-primary p-4">
        {children || <p className="text-text-secondary">Chat Interface (Epic 2)</p>}
      </main>

      <Separator orientation="vertical" className="h-full" />

      {/* Right Panel */}
      <aside
        aria-label="Retrieval Log"
        className="bg-bg-secondary p-4 border-l border-border-default"
      >
        <p className="text-text-secondary">Retrieval Log (Epic 3)</p>
      </aside>
    </div>
  );
}
```

### Unit Testing with Vitest

[Source: docs/architecture/15-testing-strategy.md]

**Test File Location:**
```
orchestratai_client/tests/unit/components/layout/three-panel-layout.test.tsx
```

**Complete Test Suite:**

```typescript
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { ThreePanelLayout } from '@/components/layout/three-panel-layout';

describe('ThreePanelLayout', () => {
  it('renders three panels', () => {
    render(<ThreePanelLayout>Test Content</ThreePanelLayout>);

    // Assert all three panels exist
    expect(screen.getByLabelText('Agent Pipeline')).toBeInTheDocument();
    expect(screen.getByLabelText('Chat Interface')).toBeInTheDocument();
    expect(screen.getByLabelText('Retrieval Log')).toBeInTheDocument();

    // Assert children render in center panel
    expect(screen.getByText('Test Content')).toBeInTheDocument();
  });

  it('uses correct grid column widths', () => {
    const { container } = render(<ThreePanelLayout />);

    // Find grid container (first div child)
    const gridContainer = container.firstChild as HTMLElement;

    // Assert grid class is applied
    expect(gridContainer).toHaveClass('grid-cols-[250px_1fr_300px]');
  });

  it('panels are properly labeled for accessibility', () => {
    render(<ThreePanelLayout />);

    // Assert aria-labels exist
    const leftPanel = screen.getByLabelText('Agent Pipeline');
    const centerPanel = screen.getByLabelText('Chat Interface');
    const rightPanel = screen.getByLabelText('Retrieval Log');

    expect(leftPanel).toBeInTheDocument();
    expect(centerPanel).toBeInTheDocument();
    expect(rightPanel).toBeInTheDocument();

    // Assert semantic HTML
    expect(leftPanel.tagName).toBe('ASIDE');
    expect(centerPanel.tagName).toBe('MAIN');
    expect(rightPanel.tagName).toBe('ASIDE');
  });

  it('renders placeholder text when no children provided', () => {
    render(<ThreePanelLayout />);

    expect(screen.getByText('Agent Pipeline (Epic 3)')).toBeInTheDocument();
    expect(screen.getByText('Chat Interface (Epic 2)')).toBeInTheDocument();
    expect(screen.getByText('Retrieval Log (Epic 3)')).toBeInTheDocument();
  });
});
```

### Running Tests

[Source: docs/architecture/3-tech-stack.md]

**Commands:**
```bash
# Run all tests
bun test

# Run tests in watch mode
bun test --watch

# Run tests with coverage
bun test --coverage

# Run specific test file
bun test three-panel-layout.test.tsx
```

**Expected Output:**
```
 ✓ tests/unit/components/layout/three-panel-layout.test.tsx (4)
   ✓ ThreePanelLayout (4)
     ✓ renders three panels
     ✓ uses correct grid column widths
     ✓ panels are properly labeled for accessibility
     ✓ renders placeholder text when no children provided

 Test Files  1 passed (1)
      Tests  4 passed (4)
```

### Accessibility (WCAG 2.1 AA)

[Source: docs/architecture/15-testing-strategy.md, Epic 1 Definition of Done]

**Accessibility Requirements:**
- ✅ Semantic HTML (main, aside tags)
- ✅ ARIA labels on each panel
- ✅ Keyboard navigation (Tab key)
- ✅ Focus indicators (browser default)
- ✅ Sufficient color contrast (design tokens ensure this)

**Manual Testing:**
1. Tab through panels - all should be focusable
2. Screen reader announces panel labels correctly
3. Lighthouse accessibility score >90

### Coding Standards Compliance

[Source: docs/architecture/16-coding-standards.md]

**Critical Rules:**
- **Server Components First**: No 'use client' directive (layout is static)
- **Design Tokens**: Use semantic tokens from @theme (bg-bg-primary, border-border-default)
- **NO Arbitrary Values**: No hardcoded colors, sizes, or arbitrary Tailwind values
- **Semantic HTML**: Use main, aside, section tags appropriately
- **TypeScript Strict Mode**: Component must compile with zero errors

### Responsive Design

[Source: docs/prd/orchestratai_prd_v2.md - Section 4.2]

**Breakpoints (Tailwind CSS v4):**
- `md:` - 768px (tablet)
- `lg:` - 1024px (desktop)

**This Story's Responsive Behavior:**
```tsx
// hidden = hide on mobile/tablet
// md:grid = show grid on 768px+
<div className="hidden md:grid grid-cols-[250px_1fr_300px]">
```

**Future Story 1.10:**
- Will add mobile tabbed interface (<768px)
- Will use `md:hidden` class to hide tabs on desktop

### Testing Standards

[Source: docs/architecture/15-testing-strategy.md]

**Testing Approach for This Story:**
- ✅ **Unit tests REQUIRED** - UI component with testable behavior
- ✅ **Test Framework**: Vitest + React Testing Library
- ✅ **Coverage Target**: 100% for this simple layout component
- ✅ **Test Types**: Rendering, grid layout, accessibility

**Test Pyramid (This Story):**
- 4 unit tests (rendering, grid, accessibility, placeholder text)
- 0 integration tests (no complex interactions yet)
- 0 e2e tests (layout only, no user flows)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-24 | 1.0 | Initial story creation for desktop three-panel layout | Bob (Scrum Master) |

---

## Dev Agent Record

### Agent Model Used

*To be completed by Dev Agent*

### Debug Log References

*To be completed by Dev Agent*

### Completion Notes

*To be completed by Dev Agent*

### File List

*To be completed by Dev Agent*

---

## QA Results

*To be completed by QA Agent*
