# Story 3.3: Build AgentCard Component with Status Badges and Colors

## Status
Draft

## Story
**As a** user,
**I want** to see individual agent cards with color-coded icons and real-time status badges,
**so that** I can identify which agent is handling my request and track their current state.

## Acceptance Criteria
1. AgentCard component renders with agent-specific color (cyan, green, blue, purple)
2. Agent name displays with correct icon based on agent type
3. Status badge shows current state (IDLE, ROUTING, ACTIVE, COMPLETE)
4. Status badge has appropriate color: IDLE=gray, ROUTING=yellow, ACTIVE=blue, COMPLETE=green
5. ACTIVE status includes animated pulse effect
6. Model name displays (e.g., "OpenAI GPT-4o")
7. Strategy badge displays (RAG, CAG, or Hybrid)
8. Card has subtle hover effect
9. All 4 agent cards render in AgentPanel container
10. Components use design tokens from Epic 1 (no arbitrary values)
11. Components are accessible (ARIA labels for status)
12. Unit tests pass with 90%+ coverage

## Tasks / Subtasks

- [ ] üö® VERIFY TOKEN EXISTENCE BEFORE STARTING (AC: 10)
  - [ ] Check if status badge tokens exist in `orchestratai_client/src/app/globals.css`
  - [ ] Search for: `--color-status-badge-routing-bg`, `--color-status-badge-active-bg`, etc.
  - [ ] If tokens DO NOT exist, HALT and ask user for permission to create them
  - [ ] Propose token structure following mobile tabs pattern (3-tier system)
  - [ ] DO NOT proceed with component until tokens are approved/created

- [ ] Create AgentStatusBadge component (AC: 3, 4, 5, 11) - ONLY AFTER TOKEN VERIFICATION
  - [ ] Create file `orchestratai_client/src/components/panels/agent-status-badge.tsx`
  - [ ] Mark as Client Component with `"use client"` directive
  - [ ] Create AgentStatusBadgeProps interface with `status: AgentStatus` prop
  - [ ] Import AgentStatus enum from `@/lib/enums`
  - [ ] Map status to display text:
    - IDLE ‚Üí "Idle"
    - ROUTING ‚Üí "Routing"
    - ACTIVE ‚Üí "Active"
    - COMPLETE ‚Üí "Complete"
  - [ ] Map status to color classes **USING COMPONENT TOKENS ONLY**:
    - IDLE ‚Üí "bg-status-badge-idle-bg text-status-badge-idle-text"
    - ROUTING ‚Üí "bg-status-badge-routing-bg text-status-badge-routing-text"
    - ACTIVE ‚Üí "bg-status-badge-active-bg text-status-badge-active-text"
    - COMPLETE ‚Üí "bg-status-badge-complete-bg text-status-badge-complete-text"
  - [ ] ‚ùå NEVER use arbitrary colors like "bg-yellow-500/20" or "text-blue-600"
  - [ ] Add animated pulse for ACTIVE status: `animate-pulse` class
  - [ ] Add ARIA label: `aria-label="${agentName} status: ${statusText}"`
  - [ ] Render as shadcn/ui Badge component
  - [ ] Use text-xs and px-2 py-1 for sizing

- [ ] Create AgentCard component (AC: 1, 2, 6, 7, 8)
  - [ ] Create file `orchestratai_client/src/components/panels/agent-card.tsx`
  - [ ] Mark as Client Component with `"use client"` directive
  - [ ] Create AgentCardProps interface:
    ```typescript
    interface AgentCardProps {
      agent: AgentId;
      name: string;
      status: AgentStatus;
      model: string;
      strategy: RetrievalStrategy | null;
      color: string;  // CSS variable like "var(--color-agent-orchestrator)"
    }
    ```
  - [ ] Import types from `@/lib/enums` and `@/lib/types`
  - [ ] Render shadcn/ui Card component as container
  - [ ] Add hover effect: `hover:shadow-md transition-shadow duration-200`
  - [ ] Add border-left accent with agent color: `style={{ borderLeftColor: color, borderLeftWidth: '4px' }}`
  - [ ] Create CardHeader section with:
    - Agent icon (colored circle with first letter of agent name)
    - Agent name in font-semibold
    - AgentStatusBadge component
  - [ ] Create CardContent section with:
    - Model name in text-sm text-text-secondary
    - Strategy badge (if strategy exists) using shadcn Badge component
  - [ ] Strategy badge colors:
    - RAG ‚Üí "bg-purple-500/20 text-purple-600"
    - CAG ‚Üí "bg-cyan-500/20 text-cyan-600"
    - HYBRID ‚Üí "bg-indigo-500/20 text-indigo-600"

- [ ] Create agent icon component (AC: 2)
  - [ ] Add AgentIcon subcomponent within agent-card.tsx
  - [ ] Render colored circle div with agent color as background
  - [ ] Display first letter of agent name in white text
  - [ ] Size: w-10 h-10, rounded-full
  - [ ] Center text with flex items-center justify-center

- [ ] Create AgentPanel container component (AC: 9)
  - [ ] Create file `orchestratai_client/src/components/panels/agent-panel.tsx`
  - [ ] Can be Server Component (receives initial data, children update)
  - [ ] Create AgentPanelProps interface with `agents` prop (array of agent data)
  - [ ] Render container div with:
    - Padding: p-4
    - Flex layout: flex flex-col gap-4
    - Height: h-full
    - Overflow: overflow-y-auto
  - [ ] Add section header: "Agent Pipeline" with text-lg font-semibold
  - [ ] Map over agents array and render AgentCard for each
  - [ ] Ensure order: Orchestrator, Billing, Technical, Policy

- [ ] Use existing agent color tokens (AC: 1, 10)
  - [ ] ‚úÖ Agent color tokens ALREADY EXIST in globals.css:188-205
  - [ ] Use `--color-agent-card-border-cyan`, `--color-agent-card-border-green`, etc.
  - [ ] Use `--color-agent-card-text-cyan`, `--color-agent-card-text-green`, etc.
  - [ ] Reference them via Tailwind: `border-agent-card-border-cyan`, `text-agent-card-text-cyan`
  - [ ] ‚ùå DO NOT create new agent color tokens - they already exist!
  - [ ] ‚ùå DO NOT use arbitrary values like `var(--color-agent-orchestrator)` if token doesn't exist

- [ ] Write unit tests for AgentStatusBadge (AC: 12)
  - [ ] Create test file `orchestratai_client/tests/unit/components/panels/agent-status-badge.test.tsx`
  - [ ] Test renders IDLE status with correct text and gray color
  - [ ] Test renders ROUTING status with yellow color
  - [ ] Test renders ACTIVE status with blue color and pulse animation
  - [ ] Test renders COMPLETE status with green color
  - [ ] Test ARIA label includes agent name and status
  - [ ] Use Vitest + React Testing Library

- [ ] Write unit tests for AgentCard (AC: 12)
  - [ ] Create test file `orchestratai_client/tests/unit/components/panels/agent-card.test.tsx`
  - [ ] Test renders agent name correctly
  - [ ] Test displays correct model name
  - [ ] Test shows strategy badge when strategy is provided
  - [ ] Test hides strategy badge when strategy is null
  - [ ] Test applies correct border color based on agent
  - [ ] Test hover effect class is present
  - [ ] Test AgentStatusBadge component is rendered

- [ ] Write unit tests for AgentPanel (AC: 12)
  - [ ] Create test file `orchestratai_client/tests/unit/components/panels/agent-panel.test.tsx`
  - [ ] Test renders all 4 agent cards
  - [ ] Test renders agents in correct order (Orchestrator, Billing, Technical, Policy)
  - [ ] Test displays "Agent Pipeline" header
  - [ ] Test container has overflow-y-auto for scrolling

- [ ] Update test coverage (AC: 12)
  - [ ] Run `bun run test:coverage` to verify 90%+ coverage
  - [ ] Add additional tests if coverage is below 90%
  - [ ] Ensure all branches covered (status variants, strategy present/absent)

## Dev Notes

### üö® CRITICAL: 3-Tier CSS Design Token System Requirements

**This story REQUIRES strict adherence to the 3-tier CSS design token system. Violations will result in PR rejection.**

[Source: docs/architecture/16-coding-standards.md, Story 2.5 precedent, globals.css lines 1-15]

#### Token System Architecture:
```
Layer 3: Component Tokens (--color-status-badge-active-bg) ‚Üê USE THESE FIRST
    ‚Üì references
Layer 2: Semantic Tokens (--color-success, --color-warning) ‚Üê FALLBACK ONLY
    ‚Üì references
Layer 1: Primitive Tokens (--token-color-blue-600) ‚Üê NEVER USE DIRECTLY
```

#### MANDATORY RULES:
1. **NEVER use Layer 1 primitive tokens** (`--token-color-*`) directly in components
2. **NEVER create new tokens without explicit approval** - HALT and ask user first with clear justification
3. **ALWAYS use Component Tokens (Layer 3) first** - Only fall back to Semantic (Layer 2) if component token doesn't exist
4. **NEVER use arbitrary Tailwind values** - `bg-blue-500/20`, `text-[#123456]`, etc. are **FORBIDDEN**
5. **Use Tailwind opacity syntax** for transparency: `bg-status-badge-active-bg/10` (NEVER bake opacity into tokens)
6. **Use approved Tailwind utilities** that reference tokens

#### Required Component Tokens (TO BE VERIFIED/CREATED):

**Status Badge Tokens** (check if these exist before starting):
```css
/* Status Badge - IDLE */
--color-status-badge-idle-bg: var(--color-bg-secondary);
--color-status-badge-idle-text: var(--color-text-secondary);
--color-status-badge-idle-border: var(--color-border-default);

/* Status Badge - ROUTING */
--color-status-badge-routing-bg: /* TBD - needs semantic yellow/amber token */
--color-status-badge-routing-text: /* TBD */

/* Status Badge - ACTIVE */
--color-status-badge-active-bg: /* TBD - needs semantic blue token */
--color-status-badge-active-text: /* TBD */

/* Status Badge - COMPLETE */
--color-status-badge-complete-bg: /* TBD - needs semantic green token */
--color-status-badge-complete-text: /* TBD */
```

**Agent Card Tokens** (THESE EXIST - see globals.css:183-205):
```css
--color-agent-card-bg: var(--color-bg-secondary)
--color-agent-card-bg-hover: var(--color-bg-tertiary)
--color-agent-card-border-cyan: var(--token-color-cyan-600)
--color-agent-card-border-green: var(--token-color-green-600)
--color-agent-card-border-blue: var(--token-color-blue-600)
--color-agent-card-border-purple: var(--token-color-purple-600)
```

#### Correct vs Incorrect Usage:
```tsx
// ‚úÖ CORRECT: Use Component Token
<Badge className="bg-status-badge-active-bg text-status-badge-active-text">

// ‚úÖ CORRECT: Use existing agent card token
<Card className="border-l-4 border-l-agent-card-border-cyan">

// ‚úÖ CORRECT: Use Component Token with opacity
<div className="bg-status-badge-routing-bg/10">

// ‚ùå WRONG: Arbitrary Tailwind color
<Badge className="bg-blue-500/20 text-blue-600">

// ‚ùå WRONG: Inline style with hex value
<Badge style={{ backgroundColor: '#2563eb' }}>

// ‚ùå WRONG: Primitive token
<Badge className="bg-[var(--token-color-blue-600)]">

// ‚ùå WRONG: Creating token without approval
// Don't add tokens to globals.css without user permission!
```

#### Token Creation Process (MANDATORY 3-STEP PATTERN):

**Follow this EXACT pattern from mobile tabs implementation** (Story 2.8 completion):

**STEP 1: Add Component Tokens to @theme** (globals.css lines 39-465)
```css
/* === Status Badge Component Tokens === */
/* Line ~456 in @theme block, after mobile tabs tokens */
--color-status-badge-idle-bg: var(--color-bg-secondary);
--color-status-badge-idle-text: var(--color-text-secondary);

--color-status-badge-routing-bg: var(--color-warning-bg);
--color-status-badge-routing-text: var(--color-warning);

--color-status-badge-active-bg: var(--color-bg-tertiary);
--color-status-badge-active-text: var(--color-border-focus); /* cyan accent */

--color-status-badge-complete-bg: var(--color-success-bg);
--color-status-badge-complete-text: var(--color-success);
```

**STEP 2: Add Utility Classes to @layer utilities** (globals.css lines 566-574)
```css
/* Status Badge Utilities - keep with shadcn overrides */
.bg-status-badge-idle-bg { background-color: var(--color-status-badge-idle-bg); }
.text-status-badge-idle-text { color: var(--color-status-badge-idle-text); }

.bg-status-badge-routing-bg { background-color: var(--color-status-badge-routing-bg); }
.text-status-badge-routing-text { color: var(--color-status-badge-routing-text); }

.bg-status-badge-active-bg { background-color: var(--color-status-badge-active-bg); }
.text-status-badge-active-text { color: var(--color-status-badge-active-text); }

.bg-status-badge-complete-bg { background-color: var(--color-status-badge-complete-bg); }
.text-status-badge-complete-text { color: var(--color-status-badge-complete-text); }
```

**STEP 3: Use Utility Classes in Component** (agent-status-badge.tsx)
```tsx
// ‚úÖ CORRECT: Use utility classes
<Badge className="bg-status-badge-active-bg text-status-badge-active-text">
  Active
</Badge>

// ‚ùå WRONG: Inline vars or arbitrary values
<Badge className="bg-[var(--color-status-badge-active-bg)]">  // NO!
<Badge className="bg-blue-500/20">  // NO!
```

**Before Creating Tokens**:
1. **HALT implementation** immediately when tokens discovered missing
2. **Propose to user** using above pattern, asking: "Status badge tokens don't exist. May I add them following the mobile tabs pattern (globals.css:455-458 + 566-574)?"
3. **Wait for explicit approval** before modifying any CSS files
4. **Document inline** with comments matching existing token style

#### Reference Implementation (Mobile Tabs Pattern):
[Source: orchestratai_client/src/app/globals.css:455-465, Story 2.8 completion notes]

```css
/* Example of correct token pattern from mobile tabs */
@theme {
  /* Layer 3: Component Token */
  --space-mobile-tabs-chat-top: var(--space-12);  /* references Layer 2 */
  --space-mobile-tabs-panel-top: var(--space-4);
  --space-mobile-tabs-panel-x: var(--space-4);
}

@layer utilities {
  /* Utility classes that consume tokens */
  .pt-mobile-tabs-chat { padding-top: var(--space-mobile-tabs-chat-top); }
  .pt-mobile-tabs-panel { padding-top: var(--space-mobile-tabs-panel-top); }
  .px-mobile-tabs-panel { padding-inline: var(--space-mobile-tabs-panel-x); }
}
```

### Source Tree Info
[Source: docs/architecture/source-tree.md#Frontend]
- Components location: `orchestratai_client/src/components/panels/`
- Create files:
  - `agent-panel.tsx` (container)
  - `agent-card.tsx` (individual card)
  - `agent-status-badge.tsx` (status indicator)
- Test location: `orchestratai_client/tests/unit/components/panels/`
- Constants location: `orchestratai_client/src/lib/constants/`

### Design Token Reference
[Source: docs/stories/epic-1-foundation-design-system.md]

**Agent Colors** (add to colors.css if missing):
```css
/* Agent-specific colors */
--color-agent-orchestrator: oklch(0.75 0.15 195); /* Cyan */
--color-agent-billing: oklch(0.70 0.15 145); /* Green */
--color-agent-technical: oklch(0.65 0.15 250); /* Blue */
--color-agent-policy: oklch(0.70 0.15 300); /* Purple */
```

**Existing Tokens to Use**:
- Surface colors: `bg-surface-primary`, `bg-surface-secondary`
- Text colors: `text-text-primary`, `text-text-secondary`, `text-text-tertiary`
- Spacing: `p-4`, `gap-4`, `px-2`, `py-1`
- Shadows: `shadow-md`
- Transitions: `transition-shadow`, `duration-200`

**CRITICAL**: Never use arbitrary Tailwind values (e.g., `bg-[#123456]`). Always use design tokens.

### Agent Status Badge Specifications
[Source: docs/stories/epic-3-agent-log-panels.md#Agent Panel]

**Status ‚Üí Color Mapping**:
- IDLE: Gray/neutral (secondary text color)
- ROUTING: Yellow/amber (indicates processing)
- ACTIVE: Blue (currently working)
- COMPLETE: Green (finished successfully)

**Animation**:
- ACTIVE status should have `animate-pulse` class for visual feedback
- Pulse animation is built into Tailwind CSS

**Accessibility**:
- Add `aria-label` with format: "Orchestrator Agent status: Active"
- Helps screen readers announce agent status changes

### Agent Card Specifications
[Source: docs/stories/epic-3-agent-log-panels.md#Agent Panel Components]

**Card Structure**:
```tsx
<Card className="hover:shadow-md transition-shadow duration-200" style={{ borderLeftColor: color, borderLeftWidth: '4px' }}>
  <CardHeader className="flex flex-row items-center justify-between">
    <div className="flex items-center gap-3">
      <AgentIcon color={color} name={name} />
      <h3 className="font-semibold">{name}</h3>
    </div>
    <AgentStatusBadge status={status} agentName={name} />
  </CardHeader>
  <CardContent>
    <p className="text-sm text-text-secondary">{model}</p>
    {strategy && (
      <Badge variant="outline" className={strategyColorClass}>
        {strategy}
      </Badge>
    )}
  </CardContent>
</Card>
```

**Agent Icon**:
- Circular div with agent color background
- First letter of agent name in white text
- Size: 40px (w-10 h-10)

### Component Architecture
[Source: docs/architecture/9-frontend-architecture.md]

**Server vs Client Components**:
- **AgentPanel**: Can be Server Component (receives initial agent data)
- **AgentCard**: Must be Client Component (updates dynamically from context)
- **AgentStatusBadge**: Must be Client Component (receives dynamic status)

**Client Component Marking**:
```tsx
"use client";

import { AgentStatus } from "@/lib/enums";
// ... component code
```

### Enums and Types
[Source: docs/architecture/4-data-models.md]

**AgentStatus Enum** (from Story 3.1):
```typescript
export enum AgentStatus {
  IDLE = "idle",
  ROUTING = "routing",
  ACTIVE = "active",
  COMPLETE = "complete",
}
```

**AgentId Enum** (Epic 1):
```typescript
export enum AgentId {
  ORCHESTRATOR = "orchestrator",
  BILLING = "billing",
  TECHNICAL = "technical",
  POLICY = "policy",
}
```

**RetrievalStrategy Enum** (Epic 1):
```typescript
export enum RetrievalStrategy {
  RAG = "rag",
  CAG = "cag",
  HYBRID = "hybrid",
}
```

### shadcn/ui Components
[Source: docs/architecture/3-tech-stack.md]

**Already Installed** (Epic 1):
- Card, CardHeader, CardContent
- Badge
- Separator
- Scroll Area

**Usage**:
```tsx
import { Card, CardHeader, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
```

### Testing Strategy
[Source: docs/architecture/15-testing-strategy.md]

**Test Framework**: Vitest + React Testing Library

**Test File Pattern**: `tests/unit/components/panels/{component-name}.test.tsx`

**Coverage Target**: 90%+

**Example Test Pattern**:
```typescript
import { render, screen } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import { AgentStatusBadge } from '@/components/panels/agent-status-badge';
import { AgentStatus } from '@/lib/enums';

describe('AgentStatusBadge', () => {
  it('renders IDLE status with gray color', () => {
    render(<AgentStatusBadge status={AgentStatus.IDLE} agentName="Orchestrator" />);
    const badge = screen.getByText('Idle');
    expect(badge).toBeInTheDocument();
    expect(badge).toHaveClass('bg-surface-secondary');
  });

  it('renders ACTIVE status with pulse animation', () => {
    render(<AgentStatusBadge status={AgentStatus.ACTIVE} agentName="Billing" />);
    const badge = screen.getByText('Active');
    expect(badge).toHaveClass('animate-pulse');
  });
});
```

Run tests: `cd orchestratai_client && bun run test`

### Coding Standards
[Source: docs/architecture/16-coding-standards.md]
- **Naming**: PascalCase for React components: `AgentCard`, `AgentStatusBadge`
- **File Names**: kebab-case for files: `agent-card.tsx`
- **Client Components**: Always add `"use client"` directive at top of file
- **Design Tokens**: Use only token classes, NO arbitrary values
- **Imports**: Use `@/` alias for imports from `src/`

### Integration with Future Stories
**Story 3.4** will add metrics display (tokens, cost, latency) to AgentCard
**Story 3.5** will connect these components to ChatProvider for real-time updates

For now, AgentCard receives props directly and is a "dumb" presentational component.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-26 | 1.0 | Initial story creation for Epic 3 | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used
<!-- Dev agent fills this in during implementation -->

### Debug Log References
<!-- Dev agent references debug logs here -->

### Completion Notes
<!-- Dev agent notes during implementation -->

### File List
<!-- Dev agent lists all modified files -->

## QA Results
<!-- QA agent fills this after validation -->
