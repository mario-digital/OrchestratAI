# <!-- Powered by BMADâ„¢ Core -->

## Status
Draft

## Story
**As a** user,
**I want** smooth hover effects on agent cards and skeleton loading states,
**so that** the interface feels polished and I see immediate visual feedback during loading

## Acceptance Criteria
1. Agent cards lift on hover (scale 1.02, shadow increase)
2. Hover animation duration: 200ms
3. Skeleton screens display while panels load
4. Shimmer effect animates across skeleton (1.5s loop)
5. Loading skeletons match final component dimensions
6. No layout shift when skeleton â†’ real content
7. Hover effect disabled on mobile (touch devices)
8. Cards return to normal smoothly on mouse leave
9. All animations use GPU acceleration
10. Works on all agent cards (4 cards total)

## Tasks / Subtasks

- [ ] Task 1: Add hover variant to AgentCard component (AC: 1, 2, 8)
  - [ ] Open `orchestratai_client/src/components/panels/agent-card.tsx`
  - [ ] Import `cardHover` variant from `@/lib/animations`
  - [ ] Change root `div` to `motion.div` from Framer Motion
  - [ ] Add `whileHover` prop with `cardHover` variant
  - [ ] Verify hover works (scale 1.02, shadow increase)
  - [ ] Verify animation duration is 200ms
  - [ ] Verify smooth return on mouse leave

- [ ] Task 2: Detect touch devices and disable hover (AC: 7)
  - [ ] Create `orchestratai_client/src/hooks/use-is-touch-device.ts`
  - [ ] Implement media query: `(hover: hover) and (pointer: fine)`
  - [ ] Return boolean indicating if device supports hover
  - [ ] In AgentCard, import and use hook
  - [ ] Conditionally apply `whileHover` only if NOT touch device
  - [ ] Test on mobile (DevTools mobile mode)
  - [ ] Verify hover disabled on touch devices

- [ ] Task 3: Create Skeleton component (AC: 3, 4, 5, 6)
  - [ ] Create `orchestratai_client/src/components/ui/skeleton.tsx`
  - [ ] Implement skeleton with shimmer effect:
    - Base gray background
    - Gradient overlay that animates left-to-right
    - 1.5s loop duration
  - [ ] Accept `className` prop for custom dimensions
  - [ ] Use `transform` for GPU acceleration
  - [ ] Create shimmer keyframes in CSS or Tailwind
  - [ ] Export Skeleton component

- [ ] Task 4: Create AgentCardSkeleton component (AC: 5, 6)
  - [ ] Create `orchestratai_client/src/components/panels/agent-card-skeleton.tsx`
  - [ ] Match exact dimensions of AgentCard:
    - Card height, padding, border radius
    - Header area skeleton (agent name, model)
    - Status badge skeleton
    - Metrics area skeleton (3 rows)
  - [ ] Use Skeleton component for each element
  - [ ] Ensure no layout shift when replaced with real AgentCard
  - [ ] Export AgentCardSkeleton

- [ ] Task 5: Add loading state to AgentPanel (AC: 3, 10)
  - [ ] Open `orchestratai_client/src/components/panels/agent-panel.tsx`
  - [ ] Add `isLoading` state variable (useState)
  - [ ] Conditionally render:
    - If `isLoading`: Render 4 AgentCardSkeleton components
    - Else: Render 4 AgentCard components
  - [ ] Set `isLoading = true` initially
  - [ ] Set `isLoading = false` after agent data loads
  - [ ] Test loading â†’ loaded transition

- [ ] Task 6: Ensure GPU acceleration for all animations (AC: 9)
  - [ ] Review cardHover variant in `lib/animations.ts`
  - [ ] Verify using `transform` (scale) instead of width/height
  - [ ] Verify using `boxShadow` property changes
  - [ ] Add `will-change: transform` hint (Framer Motion auto-applies)
  - [ ] Test in DevTools Performance tab
  - [ ] Verify no layout reflows during hover

- [ ] Task 7: Test hover performance (AC: 9)
  - [ ] Open DevTools â†’ Performance tab
  - [ ] Start recording
  - [ ] Hover over all 4 agent cards multiple times
  - [ ] Stop recording
  - [ ] Review frame rate (should be 60fps)
  - [ ] Check for jank or dropped frames
  - [ ] If < 60fps, optimize (reduce shadow complexity, etc.)

- [ ] Task 8: Write unit tests for AgentCard hover (AC: 1, 2, 7, 8)
  - [ ] Create test file: `orchestratai_client/src/components/panels/__tests__/agent-card.test.tsx`
  - [ ] Test hover variant applied when NOT touch device
  - [ ] Test hover variant NOT applied when IS touch device
  - [ ] Mock `useIsTouchDevice` hook to return true/false
  - [ ] Use React Testing Library's `userEvent.hover()`
  - [ ] Verify scale animation triggers
  - [ ] Target: 90%+ coverage

- [ ] Task 9: Write unit tests for Skeleton components (AC: 3, 4, 5)
  - [ ] Create test file: `orchestratai_client/src/components/ui/__tests__/skeleton.test.tsx`
  - [ ] Test Skeleton renders with shimmer animation
  - [ ] Test custom className applied
  - [ ] Test AgentCardSkeleton matches dimensions
  - [ ] Test no layout shift when switching to AgentCard
  - [ ] Target: 90%+ coverage

- [ ] Task 10: Integration test for loading state (AC: 3, 6, 10)
  - [ ] Create integration test: `orchestratai_client/src/components/panels/__tests__/agent-panel.test.tsx`
  - [ ] Test AgentPanel initially shows 4 skeletons
  - [ ] Mock agent data fetch
  - [ ] Wait for data to load
  - [ ] Verify skeletons replaced with AgentCards
  - [ ] Verify no layout shift (measure dimensions before/after)
  - [ ] Target: 90%+ coverage

## Dev Notes

### Previous Story Context
This story builds upon:
- **Story 3.3**: AgentCard component exists
- **Story 3.5**: AgentPanel component exists
- **Story 5.1**: Animation variants library created (cardHover defined)

### Architecture References

**Animation Variants** [Source: 5.1-message-panel-animations.story.md]
The `cardHover` variant is already defined in `lib/animations.ts`:
```typescript
export const cardHover: Variants = {
  scale: 1.02,
  boxShadow: '0 8px 16px rgba(0, 0, 0, 0.15)',
  transition: { duration: 0.2, ease: 'easeOut' },
};
```

**Design Tokens** [Source: 9-frontend-architecture.md]
- Agent card styling uses core shadow tokens
- Hover should increase from `--shadow-md` to custom elevated shadow
- Colors remain consistent (agent-specific colors)

**Accessibility** [Source: 9-frontend-architecture.md]
- Hover effects are visual only (no functional changes)
- Touch devices should not show hover effects
- Skeleton loading improves perceived performance

### Code Examples

**Touch Device Detection Hook** (hooks/use-is-touch-device.ts):
```typescript
'use client';

import { useState, useEffect } from 'react';

/**
 * Detects if device supports hover (not a touch-only device)
 * Returns false for touch devices, true for devices with mouse/trackpad
 */
export function useIsTouchDevice(): boolean {
  const [isTouch, setIsTouch] = useState(false);

  useEffect(() => {
    // Check if device supports hover and has fine pointer
    const query = window.matchMedia('(hover: hover) and (pointer: fine)');
    setIsTouch(!query.matches);

    const handleChange = () => setIsTouch(!query.matches);
    query.addEventListener('change', handleChange);
    return () => query.removeEventListener('change', handleChange);
  }, []);

  return isTouch;
}
```

**Updated AgentCard with Hover** (components/panels/agent-card.tsx):
```typescript
'use client';

import { motion } from 'framer-motion';
import { cardHover } from '@/lib/animations';
import { useIsTouchDevice } from '@/hooks/use-is-touch-device';
import { AgentId, AgentStatus, StrategyType } from '@/lib/enums';
import { AgentMetrics } from '@/lib/types';

interface AgentCardProps {
  agent: AgentId;
  status: AgentStatus;
  model: string;
  strategy: StrategyType;
  metrics: AgentMetrics;
  cacheStatus?: 'hit' | 'miss' | 'none';
  onViewGraph?: () => void;
}

export function AgentCard({
  agent,
  status,
  model,
  strategy,
  metrics,
  cacheStatus = 'none',
  onViewGraph,
}: AgentCardProps) {
  const isTouch = useIsTouchDevice();

  return (
    <motion.div
      className={`agent-card ${agent.toLowerCase()}`}
      whileHover={!isTouch ? cardHover : undefined}
      role="article"
      aria-label={`${agent} agent, status: ${status}`}
    >
      {/* Card content */}
      <div className="agent-card-header">
        <h3>{agent}</h3>
        <span className="agent-model">{model}</span>
      </div>

      <div className="agent-status">
        <span className={`status-badge ${status.toLowerCase()}`}>
          {status}
        </span>
      </div>

      <div className="agent-metrics">
        <div className="metric">
          <span className="label">Tokens:</span>
          <span className="value">{metrics.tokens}</span>
        </div>
        <div className="metric">
          <span className="label">Cost:</span>
          <span className="value">${metrics.cost.toFixed(4)}</span>
        </div>
        <div className="metric">
          <span className="label">Latency:</span>
          <span className="value">{metrics.latency}ms</span>
        </div>
      </div>

      {cacheStatus !== 'none' && (
        <div className={`cache-indicator ${cacheStatus}`}>
          {cacheStatus === 'hit' ? 'âœ“ Cache Hit' : 'â—‹ Cache Miss'}
        </div>
      )}
    </motion.div>
  );
}
```

**Skeleton Component** (components/ui/skeleton.tsx):
```typescript
import { cn } from '@/lib/utils';

interface SkeletonProps {
  className?: string;
}

/**
 * Skeleton loading component with shimmer effect
 * Used as placeholder while content loads
 */
export function Skeleton({ className }: SkeletonProps) {
  return (
    <div
      className={cn(
        'animate-shimmer relative overflow-hidden rounded-md bg-gray-200',
        'before:absolute before:inset-0',
        'before:translate-x-[-100%] before:animate-shimmer',
        'before:bg-gradient-to-r before:from-transparent',
        'before:via-white/60 before:to-transparent',
        className
      )}
    />
  );
}
```

**Shimmer Animation** (tailwind.config.ts):
```typescript
module.exports = {
  theme: {
    extend: {
      keyframes: {
        shimmer: {
          '0%': { transform: 'translateX(-100%)' },
          '100%': { transform: 'translateX(100%)' },
        },
      },
      animation: {
        shimmer: 'shimmer 1.5s infinite',
      },
    },
  },
};
```

Alternative CSS approach (globals.css):
```css
@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

.animate-shimmer::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.6),
    transparent
  );
  animation: shimmer 1.5s infinite;
}
```

**AgentCardSkeleton Component** (components/panels/agent-card-skeleton.tsx):
```typescript
import { Skeleton } from '@/components/ui/skeleton';

/**
 * Skeleton placeholder for AgentCard
 * Matches dimensions to prevent layout shift
 */
export function AgentCardSkeleton() {
  return (
    <div className="agent-card-skeleton" role="article" aria-busy="true">
      {/* Header: agent name + model */}
      <div className="mb-3 flex items-center justify-between">
        <Skeleton className="h-5 w-24" /> {/* Agent name */}
        <Skeleton className="h-4 w-32" /> {/* Model */}
      </div>

      {/* Status badge */}
      <div className="mb-4">
        <Skeleton className="h-6 w-20" />
      </div>

      {/* Metrics (3 rows) */}
      <div className="space-y-2">
        <Skeleton className="h-4 w-full" /> {/* Tokens */}
        <Skeleton className="h-4 w-full" /> {/* Cost */}
        <Skeleton className="h-4 w-full" /> {/* Latency */}
      </div>
    </div>
  );
}
```

**Updated AgentPanel with Loading State** (components/panels/agent-panel.tsx):
```typescript
'use client';

import { useState, useEffect } from 'react';
import { AgentCard } from './agent-card';
import { AgentCardSkeleton } from './agent-card-skeleton';
import { AgentId, AgentStatus, StrategyType } from '@/lib/enums';

export function AgentPanel() {
  const [isLoading, setIsLoading] = useState(true);
  const [agentsData, setAgentsData] = useState([]);

  useEffect(() => {
    // Simulate loading agent data
    const loadAgents = async () => {
      // In real app, fetch from context or API
      await new Promise(resolve => setTimeout(resolve, 1000));

      setAgentsData([
        {
          agent: AgentId.ORCHESTRATOR,
          status: AgentStatus.IDLE,
          model: 'OpenAI GPT-4o',
          strategy: StrategyType.HYBRID,
          metrics: { tokens: 0, cost: 0, latency: 0 },
        },
        {
          agent: AgentId.BILLING,
          status: AgentStatus.IDLE,
          model: 'OpenAI GPT-4o',
          strategy: StrategyType.RAG,
          metrics: { tokens: 0, cost: 0, latency: 0 },
        },
        {
          agent: AgentId.TECHNICAL,
          status: AgentStatus.IDLE,
          model: 'OpenAI GPT-4o',
          strategy: StrategyType.CAG,
          metrics: { tokens: 0, cost: 0, latency: 0 },
        },
        {
          agent: AgentId.POLICY,
          status: AgentStatus.IDLE,
          model: 'OpenAI GPT-4o',
          strategy: StrategyType.RAG,
          metrics: { tokens: 0, cost: 0, latency: 0 },
        },
      ]);

      setIsLoading(false);
    };

    loadAgents();
  }, []);

  return (
    <div className="agent-panel">
      <h2>Agents</h2>
      <div className="agent-grid">
        {isLoading ? (
          <>
            <AgentCardSkeleton />
            <AgentCardSkeleton />
            <AgentCardSkeleton />
            <AgentCardSkeleton />
          </>
        ) : (
          agentsData.map((data) => (
            <AgentCard key={data.agent} {...data} />
          ))
        )}
      </div>
    </div>
  );
}
```

**Test Example** (components/panels/__tests__/agent-card.test.tsx):
```typescript
import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { AgentCard } from '../agent-card';
import { AgentId, AgentStatus, StrategyType } from '@/lib/enums';
import * as hooks from '@/hooks/use-is-touch-device';

describe('AgentCard', () => {
  const mockProps = {
    agent: AgentId.BILLING,
    status: AgentStatus.IDLE,
    model: 'OpenAI GPT-4o',
    strategy: StrategyType.RAG,
    metrics: { tokens: 0, cost: 0, latency: 0 },
  };

  it('applies hover effect on non-touch devices', () => {
    jest.spyOn(hooks, 'useIsTouchDevice').mockReturnValue(false);

    const { container } = render(<AgentCard {...mockProps} />);
    const card = container.firstChild as HTMLElement;

    // Verify whileHover prop applied (Framer Motion adds data-attribute)
    expect(card).toHaveAttribute('data-framer-motion');
  });

  it('does NOT apply hover effect on touch devices', () => {
    jest.spyOn(hooks, 'useIsTouchDevice').mockReturnValue(true);

    const { container } = render(<AgentCard {...mockProps} />);
    const card = container.firstChild as HTMLElement;

    // Verify whileHover NOT applied
    expect(card.getAttribute('style')).not.toContain('scale');
  });

  it('renders agent information correctly', () => {
    jest.spyOn(hooks, 'useIsTouchDevice').mockReturnValue(false);

    render(<AgentCard {...mockProps} />);

    expect(screen.getByText('BILLING')).toBeInTheDocument();
    expect(screen.getByText('OpenAI GPT-4o')).toBeInTheDocument();
    expect(screen.getByText('IDLE')).toBeInTheDocument();
  });
});
```

### Integration Points
- AgentCard component from Story 3.3
- AgentPanel component from Story 3.5
- Animation variants from Story 5.1 (cardHover)
- Framer Motion library (already installed)

### Testing Requirements
- **Unit Tests**: AgentCard, Skeleton, AgentCardSkeleton
- **Integration Tests**: AgentPanel loading state
- **Coverage Target**: 90%+
- **Test hover behavior with mocked touch detection
- **Test skeleton dimensions match AgentCard**

### Performance Considerations
- Use GPU-accelerated properties (transform, opacity)
- Avoid layout reflows (no width/height animations)
- Shimmer uses transform (GPU-accelerated)
- Hover transition duration: 200ms (fast, responsive)

### Accessibility Guidelines
- Skeleton has `aria-busy="true"` attribute
- AgentCard maintains same ARIA labels during loading
- Hover is visual enhancement only (no functional change)
- Touch devices don't show hover (prevents confusion)

### Browser Compatibility
- Framer Motion supports all modern browsers
- Media query `(hover: hover)` supported in all modern browsers
- Shimmer animation uses standard CSS keyframes

## Change Log
- 2025-11-01: Story created (Draft status)

---

## Dev Agent Record

### Agent Session 1
**Date:** _YYYY-MM-DD_
**Agent:** _Agent Name/ID_
**Task:** _Which task(s) were worked on_

**Changes Made:**
- _Bullet list of changes_

**Challenges:**
- _Any issues encountered_

**Status:** _Task completion status_

---

## QA Results

### Test Session 1
**Date:** _YYYY-MM-DD_
**Tester:** _Tester Name_
**Build:** _Version/commit hash_

**Test Results:**
- [ ] Hover effect works on desktop (scale 1.02, shadow increase)
- [ ] Hover disabled on mobile/touch devices
- [ ] Skeleton loading displays correctly
- [ ] Shimmer animation smooth (1.5s loop)
- [ ] No layout shift skeleton â†’ real card
- [ ] All 4 agent cards hover correctly
- [ ] 60fps performance

**Status:** â¬œ Not Tested | ðŸŸ¡ In Progress | ðŸŸ¢ Passed | ðŸ”´ Failed
